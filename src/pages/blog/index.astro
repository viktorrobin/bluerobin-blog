---
import MainLayout from "@layouts/MainLayout.astro";
import { getCollection } from "astro:content";
import { CATEGORIES, DIFFICULTIES, SERIES } from "@/config";

// Get all published posts, sorted by date
const allPosts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Featured posts
const featuredPosts = sortedPosts.filter((post) => post.data.featured);

// Recent posts (excluding featured)
const recentPosts = sortedPosts.filter((post) => !post.data.featured).slice(0, 6);

// AI posts for showcase
const aiPosts = sortedPosts.filter((post) => post.data.category === "ai").slice(0, 3);

const formatDate = (date: Date) => date.toLocaleDateString("en-US", { year: "numeric", month: "short", day: "numeric" });

// Tech stack icons
const techStack = [
  { name: ".NET 10", icon: "ğŸŸ£", color: "bg-purple-500/20 text-purple-300" },
  { name: "Blazor Server", icon: "ğŸŒ", color: "bg-indigo-500/20 text-indigo-300" },
  { name: "NATS JetStream", icon: "âš¡", color: "bg-cyan-500/20 text-cyan-300" },
  { name: "PostgreSQL", icon: "ğŸ˜", color: "bg-blue-500/20 text-blue-300" },
  { name: "Qdrant", icon: "ğŸ”®", color: "bg-red-500/20 text-red-300" },
  { name: "MinIO", icon: "ğŸª£", color: "bg-pink-500/20 text-pink-300" },
  { name: "Ollama", icon: "ğŸ¦™", color: "bg-orange-500/20 text-orange-300" },
  { name: "Kubernetes", icon: "â˜¸ï¸", color: "bg-sky-500/20 text-sky-300" },
];
---

<MainLayout title="The BlueRobin Project" description="A homelab journey from medical document search to production AI">
  <!-- Hero Section with Project Overview -->
  <section class="relative overflow-hidden bg-gradient-to-br from-slate-900 via-neural-900/50 to-slate-900">
    <!-- Animated background elements -->
    <div class="absolute inset-0 overflow-hidden">
      <div class="absolute -top-40 -right-40 w-80 h-80 bg-neural-500/10 rounded-full blur-3xl animate-pulse"></div>
      <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-aurora-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-quantum-500/5 rounded-full blur-3xl"></div>
    </div>
    
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 sm:py-32">
      <div class="text-center mb-16">
        
        
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-display font-bold text-white mb-6">
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-neural-400 via-quantum-400 to-aurora-400">The BlueRobin Project</span>
        </h1>
        
        <p class="text-lg sm:text-xl text-slate-300 max-w-4xl mx-auto mb-6">
          An AI-powered personal document archive that transforms how you organize, 
          search, and understand your documents.
        </p>
        
        <p class="text-base text-slate-400 max-w-3xl mx-auto mb-10">
          From homelab experiment to production-ready system â€” documenting every step of building 
          a modern cloud-native application with <strong class="text-neural-400">.NET</strong>, 
          <strong class="text-quantum-400">Kubernetes</strong>, and 
          <strong class="text-aurora-400">AI/ML</strong>.
        </p>
        
        <div class="flex flex-wrap justify-center gap-4">
          <a href="/architecture/" class="btn-primary">
            ğŸ—ï¸ Architecture
          </a>
          <a href="/articles/" class="btn-secondary">
            ğŸ“š All Articles
          </a>
          <a href="https://github.com/victorrentea/bluerobin" target="_blank" class="btn-secondary">
            <svg class="w-5 h-5 mr-2 inline" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            GitHub
          </a>
        </div>
      </div>

      <!-- Tech Stack Pills -->
      <div class="flex flex-wrap justify-center gap-3 mb-16">
        {techStack.map((tech) => (
          <span class={`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium ${tech.color} backdrop-blur-sm border border-white/10`}>
            <span>{tech.icon}</span>
            {tech.name}
          </span>
        ))}
      </div>

      <!-- Key Features / Pain Points Grid -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto">
        <div class="glass-card-dark p-6 text-center">
          <div class="text-4xl mb-4">ğŸ”</div>
          <h3 class="text-lg font-semibold text-white mb-2">Semantic Search</h3>
          <p class="text-slate-400 text-sm">
            Find documents by meaning, not just keywords. RAG-powered Q&A over your entire archive.
          </p>
        </div>
        <div class="glass-card-dark p-6 text-center">
          <div class="text-4xl mb-4">ğŸ“„</div>
          <h3 class="text-lg font-semibold text-white mb-2">AI-Powered OCR</h3>
          <p class="text-slate-400 text-sm">
            Docling extracts text with layout preservation. Tables, headings, and structure intact.
          </p>
        </div>
        <div class="glass-card-dark p-6 text-center">
          <div class="text-4xl mb-4">ğŸ”</div>
          <h3 class="text-lg font-semibold text-white mb-2">Per-User Encryption</h3>
          <p class="text-slate-400 text-sm">
            Every user gets isolated storage with dedicated KMS keys. Zero-trust architecture.
          </p>
        </div>
        <div class="glass-card-dark p-6 text-center">
          <div class="text-4xl mb-4">âš¡</div>
          <h3 class="text-lg font-semibold text-white mb-2">Event-Driven</h3>
          <p class="text-slate-400 text-sm">
            NATS JetStream for reliable async processing. Real-time UI updates without polling.
          </p>
        </div>
        <div class="glass-card-dark p-6 text-center">
          <div class="text-4xl mb-4">ğŸ•¸ï¸</div>
          <h3 class="text-lg font-semibold text-white mb-2">Knowledge Graph</h3>
          <p class="text-slate-400 text-sm">
            FalkorDB connects entities across documents. Discover relationships automatically.
          </p>
        </div>
        <div class="glass-card-dark p-6 text-center">
          <div class="text-4xl mb-4">ğŸ </div>
          <h3 class="text-lg font-semibold text-white mb-2">Self-Hosted</h3>
          <p class="text-slate-400 text-sm">
            Runs on a homelab K3s cluster. Local AI with Ollama. Your data stays yours.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Architecture Diagram Section -->
  <section class="bg-slate-50 dark:bg-slate-900 py-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-display font-bold text-slate-900 dark:text-slate-100 mb-4">
          ğŸ—ï¸ System Architecture
        </h2>
        <p class="text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">
          A cloud-native document intelligence platform built on DDD principles with event-driven microservices.
        </p>
      </div>
      
      <!-- Simplified Architecture Diagram using Divs -->
      <div class="glass-card p-8 max-w-4xl mx-auto">
        <div class="grid grid-cols-3 gap-4 text-center text-sm">
          <!-- Frontend Row -->
          <div class="col-span-3 mb-4">
            <div class="inline-flex items-center gap-4 p-4 rounded-xl bg-purple-100 dark:bg-purple-900/30 border border-purple-200 dark:border-purple-800">
              <span class="text-2xl">ğŸŒ</span>
              <div class="text-left">
                <div class="font-semibold text-purple-900 dark:text-purple-100">Blazor Server</div>
                <div class="text-xs text-purple-700 dark:text-purple-300">Interactive UI with real-time updates</div>
              </div>
            </div>
          </div>
          
          <!-- API & Workers Row -->
          <div class="col-span-3 grid grid-cols-2 gap-4 mb-4">
            <div class="p-4 rounded-xl bg-indigo-100 dark:bg-indigo-900/30 border border-indigo-200 dark:border-indigo-800">
              <span class="text-2xl">ğŸ”Œ</span>
              <div class="font-semibold text-indigo-900 dark:text-indigo-100">FastEndpoints API</div>
              <div class="text-xs text-indigo-700 dark:text-indigo-300">REST + OpenAPI</div>
            </div>
            <div class="p-4 rounded-xl bg-orange-100 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-800">
              <span class="text-2xl">âš™ï¸</span>
              <div class="font-semibold text-orange-900 dark:text-orange-100">Background Workers</div>
              <div class="text-xs text-orange-700 dark:text-orange-300">OCR, Embeddings, NER</div>
            </div>
          </div>
          
          <!-- Messaging Row -->
          <div class="col-span-3 mb-4">
            <div class="p-4 rounded-xl bg-cyan-100 dark:bg-cyan-900/30 border border-cyan-200 dark:border-cyan-800">
              <span class="text-2xl">âš¡</span>
              <span class="font-semibold text-cyan-900 dark:text-cyan-100 ml-2">NATS JetStream</span>
              <span class="text-xs text-cyan-700 dark:text-cyan-300 ml-2">Event-Driven Messaging</span>
            </div>
          </div>
          
          <!-- Data Layer Row -->
          <div class="p-4 rounded-xl bg-blue-100 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800">
            <span class="text-2xl">ğŸ˜</span>
            <div class="font-semibold text-blue-900 dark:text-blue-100">PostgreSQL</div>
            <div class="text-xs text-blue-700 dark:text-blue-300">Metadata</div>
          </div>
          <div class="p-4 rounded-xl bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800">
            <span class="text-2xl">ğŸ”®</span>
            <div class="font-semibold text-red-900 dark:text-red-100">Qdrant</div>
            <div class="text-xs text-red-700 dark:text-red-300">Vectors</div>
          </div>
          <div class="p-4 rounded-xl bg-pink-100 dark:bg-pink-900/30 border border-pink-200 dark:border-pink-800">
            <span class="text-2xl">ğŸª£</span>
            <div class="font-semibold text-pink-900 dark:text-pink-100">MinIO</div>
            <div class="text-xs text-pink-700 dark:text-pink-300">Documents</div>
          </div>
          
          <!-- AI Services Row -->
          <div class="col-span-3 mt-4 grid grid-cols-3 gap-4">
            <div class="p-3 rounded-xl bg-amber-100 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800">
              <span class="text-xl">ğŸ¦™</span>
              <div class="font-semibold text-amber-900 dark:text-amber-100 text-xs">Ollama</div>
            </div>
            <div class="p-3 rounded-xl bg-emerald-100 dark:bg-emerald-900/30 border border-emerald-200 dark:border-emerald-800">
              <span class="text-xl">ğŸ“„</span>
              <div class="font-semibold text-emerald-900 dark:text-emerald-100 text-xs">Docling OCR</div>
            </div>
            <div class="p-3 rounded-xl bg-sky-100 dark:bg-sky-900/30 border border-sky-200 dark:border-sky-800">
              <span class="text-xl">ğŸ</span>
              <div class="font-semibold text-sky-900 dark:text-sky-100 text-xs">spaCy NER</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Series Overview -->
  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <h2 class="text-2xl font-display font-bold text-slate-900 dark:text-slate-100 mb-8">
      ğŸ“š Article Series
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {Object.entries(SERIES).map(([key, series]) => (
        <a href={`/tags/${key}/`} class="glass-card p-6 hover:shadow-lg transition-all hover:-translate-y-1">
          <h3 class="font-semibold text-slate-900 dark:text-slate-100 mb-2">{series.title}</h3>
          <p class="text-sm text-slate-600 dark:text-slate-400">{series.description}</p>
        </a>
      ))}
    </div>
  </section>

  <!-- Recent Articles -->
  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-2xl font-display font-bold text-slate-900 dark:text-slate-100">
        Recent Articles
      </h2>
      <a href="/articles/" class="text-neural-600 dark:text-neural-400 hover:underline">
        View all â†’
      </a>
    </div>

    {sortedPosts.length === 0 ? (
      <div class="glass-card p-12 text-center">
        <p class="text-slate-600 dark:text-slate-400 text-lg">
          ğŸš§ Articles coming soon! The first article in the DDD series is being prepared.
        </p>
      </div>
    ) : (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {sortedPosts.slice(0, 6).map((post) => {
          const categoryMeta = CATEGORIES[post.data.category];
          const difficultyMeta = DIFFICULTIES[post.data.difficulty];
          return (
            <article class="article-card">
              <div class="flex items-center gap-2 mb-3">
                <span class={`text-xs px-2 py-0.5 rounded-full category-${post.data.category}`}>
                  {categoryMeta.icon} {post.data.category}
                </span>
                <span class={`text-xs px-2 py-0.5 rounded-full difficulty-${post.data.difficulty}`}>
                  {difficultyMeta.label}
                </span>
              </div>
              <a href={`/articles/${post.slug}/`}>
                <h2>{post.data.title}</h2>
              </a>
              <p>{post.data.description}</p>
              <div class="mt-4 flex items-center justify-between text-sm text-slate-500 dark:text-slate-400">
                <time datetime={post.data.pubDate.toISOString()}>
                  {formatDate(post.data.pubDate)}
                </time>
                {post.data.readTime && <span>{post.data.readTime}</span>}
              </div>
            </article>
          );
        })}
      </div>
    )}
  </section>

  <!-- Quick Links by Category -->
  <section class="bg-slate-100 dark:bg-slate-800/50 py-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-2xl font-display font-bold text-slate-900 dark:text-slate-100 mb-8">
        Browse by Category
      </h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {Object.entries(CATEGORIES).map(([key, category]) => (
          <a href={`/${key}/`} class="glass-card p-6 hover:shadow-lg transition-all hover:-translate-y-1 text-center">
            <div class="text-3xl mb-3">{category.icon}</div>
            <h3 class="font-semibold text-slate-900 dark:text-slate-100 mb-1">{category.title}</h3>
            <p class="text-sm text-slate-600 dark:text-slate-400">{category.description}</p>
          </a>
        ))}
      </div>
    </div>
  </section>
</MainLayout>
